<div class="br-mainpanel">
   
    <div class="br-pagetitle">
        <i class="icon ionicons ion-edit"></i>
        <div>
          	<h4>Editer  les Allocations</h4>
          	<p style="color:blue;" class="mg-b-0">----</p>
        </div>
    </div><!-- d-flex -->
    <div class="br-pagebody">
        <div class="br-section-wrapper">
          

        <form id="form-send" class="js-form-send {{app.user.hasAccess('allocation-Redit')}}" action="{{path('allocation-Redit')}}" method="POST">
            <div class="form-layout form-layout-1">
                <div class="row mg-b-25">
                 
                    <div class="col-lg-4">
                        <div class="form-group">
                            <label class="form-control-label">Type de Chambres: <span class="tx-danger">*</span></label>
                            <select name="typebed" class="form-control typedechambre select2" data-placeholder="Choose one" style="width: 75%">
                                <option value="0">Sélectionner le type</option>
                                {% for chambre in typchambres %}
                                    <option value="{{chambre.id}}">{{chambre.nom}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                  
                    <div class="col-lg-4">
                        <div class="form-group">
                            <label class="form-control-label">Heure d'arrivée  : <span class="tx-danger">*</span></label>
                            <div class="d-flex">
                                <div class="input-group wd-300">
                                    <input id="timeat" name="arriver" type="datetime-local" min="now" class="heurearivee form-control" value="">
                                </div><!-- input-group -->
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="form-group">
                            <label class="form-control-label">Durée : <span class="tx-danger">*</span></label>
                             <select name="sejourclient" class="form-control tarifdeschambres select2" data-placeholder="Choose one" style="width: 75%">
                                    <option value="0">Durée du sejour</option>
                             </select>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="form-group">
                            <label class="form-control-label">Quantité <span class="tx-danger">*</span></label>
                              <input value="1" id="quantiter"  class="form-control" type="number" name="qte">
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="form-group">
                        <label class="form-control-label">Client: <span class="tx-danger">*</span></label>
                            <select name="client" class="form-control select2" data-placeholder="Choose one" style="width: 100%">
                                {% for client in clients %}
                                    <option value="{{client.id}}">{{client.nom}} {{client.prenom}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div> 
                    <div class="col-lg-4">
                        <div class="form-group ">
                            <label class="form-control-label">Chambre disponible: <span class="tx-danger">*</span></label>
                            <select name="chambre" class="form-control chambres select2" data-placeholder="Choose one" style="width: 75%">
                                
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        {# <a onclick="checkdisponibilteofroom()" style="margin-top: 30px; color:white;" class="btn btn-primary btn-with-icon">
                            <div class="ht-40 justify-content-between">
                                <span class="pd-x-15">Verifier</span>
                                <span class="icon wd-40"><i id="vefificationstatic" class="fa fa-check-circle"></i> <i id="vefificationenable" class="fa fa-spinner fa-pulse"></i></span>
                            </div>
                        </a> #}
                         <button type="submit" class="btn btn-primary">Modifier</button>	
                    </div>
                    
                    
                    
                </div>
               {#  <div id="contentaftervalide"> #}
                   
                   {#  <div class="form-layout-footer"> #}
                    
                    {# <div class="row row-sm">
                        <div class="col-sm-12 col-xl-12">
                            <div class="col-md mg-t-20 mg-md-t-0">
                                <div class="card bd-0">
                                    <div class="card-header bg-dark">
                                    <ul class="nav nav-tabs nav-tabs-for-dark card-header-tabs">
                                        <li class="nav-item">
                                        <a class="nav-link bd-0 active pd-y-8" href="#popular2" data-toggle="tab">Client Existant</a>
                                        </li>
                                        <li class="nav-item">
                                        <a class="nav-link bd-0 tx-gray-light" href="#recent2" data-toggle="tab">Ajouter un client</a>
                                        </li>
                                        
                                    </ul>
                                    </div><!-- card-header -->
                                    <div class="card-body color-gray-lighter bd bd-t-0 rounded-bottom">
                                    <div class="tab-content">
                                        <div class="tab-pane active" id="popular2">
                                        <h4>Client Existant</h4>
                                    
                                        <div class="row row-sm">
                                        <div class="col-lg-3">
                                            <div class="form-group">
                                                <select name="client" class="form-control select2" data-placeholder="Choose one" style="width: 100%">
                                                    {% for client in clients %}
                                                        <option value="{{client.id}}">{{client.nom}} {{client.prenom}}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div> 
                                        </div>
                                        </div><!-- tab-pane -->
                                        <div class="tab-pane" id="recent2">
                                        <h4>Ajouter un client</h4>
                                        <button class="btn btn-primary" ><a href="{{path('index-clientdash')}}" style="padding: 0px !important; color:white;" class=" nav-link ajax-link" ><i class="fa fa-plus" aria-hidden="true"></i>Ajouter</a></button> 

                                        </div><!-- tab-pane -->

                                        
                                    </div><!-- card-body -->
                                </div><!-- card -->
                            </div><!-- col -->
                        </div>
                    </div> #}
                  {#   <br><br><br> #}

                  {# 
                        <button type="submit" id="btn-save-nouveau" class="btn btn-primary mg-r-5">Valider</button>
                        <button type="button" class="btn btn-secondary" onclick="hide()">Annuler</button>
                    </div> #}
                {# </div> #}
            </div>
        </div>


           
        </div><!-- br-pagebody -->
    </div><!-- br-mainpanel -->
<script>
    
        $('#vefificationstatic').show();
        $('#vefificationenable').hide();
        $("#contentaftervalide").hide();
        $(".formelement").hide();

        $('.select2').select2({
        width: 'resolve'
        });
    
        // Select2 by showing the search
        $('.select2-show-search').select2({
            minimumResultsForSearch: ''
        });
    
        // Select2 with tagging support
        $('.select2-tag').select2({
        tags: true,
            tokenSeparators: [',', ' ']
        });

        $( ".typedechambre" ).change(function() {
            $('.tarifdeschambres').find('option').remove();
                $.ajax({
                    url: "/getalltarif?id="+$(this).children("option:selected").val(),
                    type: 'GET',
                }).done(function(data){

                    console.log(data.length);  
                    i=0;
                    while(i<data.length){
                        $('.tarifdeschambres').append('<option value="'+data[i].id+'" >'+data[i].nom+'('+data[i].duree+'heure - '+data[i].prix+'FCFA )'+'</option>');
                        i++;
                    }  
                        
                }).fail(function(error){
                    console.log("no ok");
                });
        });

   
</script>
<script>
    function checkdisponibilteofroom() {
        $('#vefificationstatic').hide();
        $('#vefificationenable').show();
        $("#contentaftervalide").hide();
        var typechambre=$('.typedechambre').children("option:selected").val();
        //alert($('.typedechambre').children("option:selected").val());
        //alert($('.tarifdeschambres').children("option:selected").val());
        $('.chambres').find('option').remove();
        
        //alert($('#timeat').val());
        $.ajax({
            url: "/getallchambrelibre",
            type: 'POST',
            dataType: 'json',
            data:{"datearrivee": $('#timeat').val(),"typechambre": typechambre,"duree":$('.tarifdeschambres').children("option:selected").val(),
            "quantite":$('#quantiter').val()}
        }).done(function(data){ 
                    $('#vefificationstatic').show();
                    $('#vefificationenable').hide();
                    if(data.length==0){
                        
                            Swal.fire({
                                position: 'top-end',
                                icon: 'error',
                                title: "pas de chambre disponible",
                                showConfirmButton: false,
                                timer: 2000
                            })
                       
                    }else{
                        $("#contentaftervalide").show();
                        i=0;
                        while(i<data.length){
                            $('.chambres').append('<option value="'+data[i].id+'" >'+data[i].numero+'</option>');
                            i++;
                        } 
                    }
                     
                
        }).fail(function(error){
            $('#vefificationstatic').show();
            $('#vefificationenable').hide();
        });
    }
</script>
<script>
$(".js-form-sendallocation").on('submit', function(e) {
    e.preventDefault();
    //////
    var idForm = $(this).attr('id');
    var element = $("#" + idForm + " #btn-save-nouveau");
    var element2 = $("#" + idForm + " #btn-save-nouveau");
    element.html('Chargement... <span class="fa fa-spinner fa-pulse"></span>');
    element.attr("disabled", "true");
    //////
    var dataform = $(this).serialize();
    $.ajax({
            url: "/allocationadd",
            type: 'POST',
            dataType: 'json',
            data:dataform
        }).done(function(data){ 
            $("#contentaftervalide").hide();
            console.log(idForm);
            console.log(element);
            element2.html('VALIDER');
            element2.attr("disabled", "false");
            if(data.success){
                    Swal.fire({
                    title: 'enregistrement terminer',
                    text: "Voulez vous imprimer la facture ?",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Imprimer'
                    }).then((result) => {
                    if (result.isConfirmed) {
                      window.open("/printrecuallocation?id="+data.id, '_blank');  
                    }
                    })
            }else{
                Swal.fire({
                    position: 'top-end',
                    icon: 'error',
                    title: "problème d'enregistrer !",
                    showConfirmButton: false,
                    timer: 2000
                })
            }
             console.log(data);        
                
        }).fail(function(error){
            console.log("no ok");
        });
}) 
</script>

