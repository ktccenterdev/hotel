<style>
#myshow1 {
 
  display:none;
  
}


</style>
    
    
    <div class="br-pagetitle">
        <i class="icon ion-man"></i>
        <div>
          	<h4>Hebergement (NUITEE)</h4>
          	<p style="color:blue;" class="mg-b-0">----</p>
        </div>
    </div><!-- d-flex -->
           
        <div class="br-section-wrapper">

            <div class="container-fixed" align="center">
                {% for message in app.flashes('danger') %}
                    <div class="alert alert-danger">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <div class="d-flex align-items-center justify-content-start">
                            <i class="fas fa-times alert-icon tx-32 mg-t-5 mg-xs-t-0"></i>
                            <strong class="d-block d-sm-inline-block-force">{{ message }}</strong>
                        </div>
                    </div>
                {% endfor %}
            </div>
            
            
           

        <form id="form-send" class="js-form-sendallocation {{app.user.hasAccess('allocation-add')}}" data-toggle="ajax" data-target="monContent" action="{{path('allocation-add')}}" method="POST">
            <div class="form-layout form-layout-1">
                <div class="row mg-b-25">
                    <div class="col-lg-4">
                        <div class="form-group">
                            <label class="form-control-label">Type de Chambres: <span class="tx-danger">*</span></label>
                            <select name="typebed" class="form-control typedechambre js-select2" data-placeholder="Choose one" style="width: 75%">
                                <option value="0">Sélectionner le type</option>
                                {% set newArray = [] %}
                                {% for tarif in tarifs %}
                                    {% if tarif.typechambre.id not in newArray %}
                                        <option value="{{ tarif.typechambre.id }}">{{tarif.typechambre.nom}}</option>
                                        {% set newArray = newArray|merge([tarif.typechambre.id ]) %}
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="form-group">
                            <label class="form-control-label">Heure d'arrivée  : <span class="tx-danger">*</span></label>
                            <div class="d-flex">
                                <div class="input-group wd-300">
                                    <input id="timeat" name="arriver" type="datetime-local" min="now" class="heurearivee form-control">
                                </div><!-- input-group -->
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="form-group">
                            <label class="form-control-label">Durée : <span class="tx-danger">*</span></label>
                             <select name="sejourclient" id="montant" class="form-control tarifdeschambres js-select2" data-placeholder="Choose one" style="width: 75%">
                                    <option value="0">Durée du sejour</option>
                             </select>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="form-group">
                            <label class="form-control-label">Quantité <span class="tx-danger">*</span></label>
                              <input value="1" id="quantiter"  class="form-control" type="number" name="qte">
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <a onclick="checkdisponibilteofroom()" style="margin-top: 30px; color:white;" class="btn btn-primary btn-with-icon">
                            <div class="ht-40 justify-content-between">
                                <span class="pd-x-15">Verifier</span>
                                <span class="icon wd-40"><i id="vefificationstatic" class="fa fa-check-circle"></i> <i id="vefificationenable" class="fa fa-spinner fa-pulse"></i></span>
                            </div>
                        </a>
                    </div>
                    
                    
                    
                </div>
                <div id="contentaftervalide">
                    <div class="row mg-b-25">
                        <div class="col-lg-8">
                            <div class="form-group mg-b-10-force">
                                <label class="form-control-label">Chambre disponible: <span class="tx-danger">*</span></label>
                                <select name="chambre" class="form-control chambres js-select2" data-placeholder="Choose one" style="width: 75%">
                                    
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-layout-footer">
                     
                     <div class="row row-sm">
                            <div class="col-sm-12 col-xl-12">
                                <div class="col-md mg-t-20 mg-md-t-0">
                                    <div class="card bd-0">
                                        <div class="card-header bg-dark">
                                        <ul class="nav nav-tabs nav-tabs-for-dark card-header-tabs">
                                            <li class="nav-item">
                                                <a class="nav-link bd-0 active pd-y-8" href="#popular2" data-toggle="tab">Information sur le client</a>
                                            </li>
                                            <div class="container-fixed" align="center">
                                                {% for message in app.flashes('danger') %}
                                                    <div class="alert alert-danger">
                                                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                            <span aria-hidden="true">&times;</span>
                                                        </button>
                                                        <div class="d-flex align-items-center justify-content-start">
                                                            <i class="fas fa-times alert-icon tx-32 mg-t-5 mg-xs-t-0"></i>
                                                            <strong class="d-block d-sm-inline-block-force">{{ message }}</strong>
                                                        </div>
                                                    </div>
                                              {% endfor %}
                                            </div>

                                         
                                        </ul>
                                        </div><!-- card-header -->
                                        <div class="card-body color-gray-lighter bd bd-t-0 rounded-bottom">
                                        <div class="tab-content">
                                            <div class="tab-pane active" id="popular2">
                                                <input style="display: none;" type="checkbox" id="checkclient" name="noveauclientckeck">
                                                <div id="oldclient">
                                                    
                                                    <div class="row row-sm">
                                                        <div class="col-lg-3">
                                                            <h4>Client Existant</h4>
                                                            <div class="form-group">
                                                           
                                                                <select name="client" class="paiement form-control js-select2" placeholder="Sélectionner" style="width: 100%">
                                                                    {% for client in clients %}
                                                                        <option value="{{client.id}}" >{{client.nom}} {{client.prenom}} ( {{client.solde}} XAF)</option>
                                                                       
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                            <div class="col-lg-3">
                                                                
                                                            </div>
                                                        </div> 
                                                        <div class="col-lg-4"  >
                                                            {# <div class="form-check form-check-inline">
                                                                <label  for="inlineRadio2">Payer avec acompte</label>
                                                                <input class="form-check-input" type="checkbox" name="radio" style="margin-top: -9; margin-left: 15;" id="inlineRadio2" value="acompte" >

                                                                <label  for="inlineRadio2">Payer En cash</label>
                                                                <input class="form-check-input" type="checkbox" name="cash" style="margin-top: -9; margin-left: 15;" id="inlineRadio2" value="cash" >
                                                            </div> #}
                                                                    <div class="form-check form-check-inline" id="canpay">
                                                                        <input class="form-check-input" type="checkbox" name="radio" id="inlineRadio1" value="acompte">
                                                                        <label  for="inlineRadio1">Payer avec acompte</label>
                                                                    </div>
                                                                   {#  <div class="form-check form-check-inline">
                                                                        <input class="form-check-input" type="radio" name="radio" id="inlineRadio2" value="cash" checked>
                                                                        <label  for="inlineRadio2">Payer En cash</label>
                                                                    </div> #}
                                                            {# <div class="form-group" >
                                                           
                                                                <input id="montantcash"  class="form-control" type="number" name="montantcash" placeholder="Montant d'allocation ">
                                                                <input id=""  class="form-control" type="" name="montant" disabled>
                                                            
                                                            </div> #}
                                                        </div> 
                                                    </div>
                                                </div>
                                                <div>
                                                    <h2 class="textnewclient">Si le client ne figure pas dans la liste vous pouvez l'ajouter</h2>
                                                    <a id="btnaffformadd" style="padding: 0px 20px; color: white;"  class="btn btn-primary btn-icon textnewclient">
                                                        <div>Ajouter<i class="fa fa-user-plus"></i></div>
                                                    </a>

                                                </div>
                                                    <div id="form-new-client">
                                                        <h4>Nouveau Client </h4>
                                                        <!-- block de nouveau client -->
                                                            
                                                        <div class="row mg-b-25" style="">
                                                            <div class="col-lg-3" style="background-color:#0866c6; color:black;">
                                                                <div class="form-group">
                                                                    <label class="form-control-label">Nom: <span class="tx-danger">*</span></label>
                                                                    <input class="form-control" type="text" name="nom"  placeholder="Nom" >
                                                                </div>
                                                            </div><!-- col-3 -->
                                                            <div class="col-lg-3" style="background-color:#0866c6; color:black;" >
                                                                <div class="form-group">
                                                                    <label class="form-control-label">Prenom: <span class="tx-danger">*</span></label>
                                                                    <input class="form-control" type="text" name="prenom"  placeholder="Prenom">
                                                                </div>
                                                            </div><!-- col-3 -->
                                                            <div class="col-lg-3" style="background-color:#0866c6; color:black;">
                                                                <div class="form-group">
                                                                    <label class="form-control-label">CNI: <span class="tx-danger">*</span></label>
                                                                    <input class="form-control" type="text" name="cni"  placeholder="cni">
                                                                </div>
                                                            </div><!-- col-3 -->
                                                            <div class="col-lg-3" style="background-color:#0866c6; color:black;">
                                                                <div class="form-group" >
                                                                    <label class="form-control-label">Sexe: <span class="tx-danger">*</span></label>
                                                                    <select class="form-control" name="sex">
                                                                    <option label="--choisir--"></option>
                                                                        <option value="Feminin">Feminin</option>
                                                                        <option value="Masculin">Masculin</option>
                                                                    </select>
                                                                </div>
                                                            </div><!-- col-3 -->
                                                        </div>
                                                            <div style="    background: #61377b;" class="card-body color-gray-lighter bd bd-t-0 rounded-bottom">
                                                            <div class="tab-content">
                                                                <div class="tab-pane active" id="popular2">
                                                                
                                                                    
                                                                    <div class="row row-sm">
                                                                    
                                                                        <div class="optional col-lg-4"  >
                                                                            <div class="form-group">
                                                                                <label class="form-control-label">Date de naissance: <span class="tx-danger"></span></label>
                                                                                <input class="form-control" type="date" name="datenaisance"  placeholder="date de naisance">
                                                                            </div>
                                                                        </div><!-- col-4 -->
                                                                        <div class="optional col-lg-4">
                                                                            <div class="form-group">
                                                                                <label class="form-control-label">lieux de naissance: <span class="tx-danger"></span></label>
                                                                                <input class="form-control" type="text" name="lieunaisance"  placeholder="lieu de  naisance">
                                                                            </div>
                                                                        </div><!-- col-4 -->
                                                                        <div class="optional col-lg-4">
                                                                            <div class="form-group">
                                                                                <label class="form-control-label">Etat civil: <span class="tx-danger"></span></label>
                                                                                <select class="form-control" name="etatcivil" >
                                                                                    <option label="--choisir--"></option>
                                                                                    <option value="Mariéé">Mariéé</option>
                                                                                    <option value="Célibataire">Célibataire</option>
                                                                                </select>                        
                                                                            </div>
                                                                        </div><!-- col-4 -->
                                                                        <div class="optional col-lg-4">
                                                                            <div class="form-group">
                                                                                <label class="form-control-label">Profession: <span class="tx-danger"></span></label>
                                                                                <div class="input-group">
                                                                                    <div class="input-group-prepend">
                                                                                        <div class="input-group-text">
                                                                                            <i class="fas fa-phone tx-16 lh-0 op-6"></i>
                                                                                        </div>
                                                                                    </div><!-- input-group-prepend -->
                                                                                    <input class="form-control" type="text" name="profession"  placeholder="profession">
                                                                                </div>
                                                                            </div>
                                                                        </div><!-- col-4 -->
                                                                        <div class="optional col-lg-4">
                                                                            <div class="form-group">
                                                                                <label class="form-control-label">Nationalite: <span class="tx-danger"></span></label>
                                                                                <input class="form-control" type="text" name="nationalite"  placeholder="nationalite">
                                                                            </div>
                                                                        </div><!-- col-4 -->
                                                                        <div class="optional col-lg-4">
                                                                            <div class="form-group">
                                                                                <label class="form-control-label">Téléphone: <span class="tx-danger"></span></label>
                                                                                <div class="input-group">
                                                                                    <div class="input-group-prepend">
                                                                                        <div class="input-group-text">
                                                                                            <i class="fas fa-phone tx-16 lh-0 op-6"></i>
                                                                                        </div>
                                                                                    </div><!-- input-group-prepend -->
                                                                                    <input class="form-control" type="text" name="phone"  placeholder="phone">
                                                                                </div>
                                                                            </div>
                                                                        </div><!-- col-4 -->
                                                                        <div class="optional col-lg-4">
                                                                            <div class="form-group">
                                                                                <label class="form-control-label">Addresse: <span class="tx-danger"></span></label>
                                                                                <div class="input-group">
                                                                                    <div class="input-group-prepend">
                                                                                        <div class="input-group-text">
                                                                                        <i class="fas fa-bed tx-16 lh-0 op-6"></i>
                                                                                        </div>
                                                                                    </div><!-- input-group-prepend -->
                                                                                    <input class="form-control" type="text" name="adresse"  placeholder="adresse">
                                                                                </div>
                                                                            </div>
                                                                        </div><!-- col-4 -->
                                                                        <div class="optional col-lg-4">
                                                                            <div class="form-group">
                                                                                <label class="form-control-label">Email: <span class="tx-danger"></span></label>
                                                                                <div class="input-group">
                                                                                    <div class="input-group-prepend">
                                                                                        <div class="input-group-text">
                                                                                            <i class="fas fa-envelope tx-16 lh-0 op-6"></i>
                                                                                        </div>
                                                                                    </div><!-- input-group-prepend -->
                                                                                    <input class="form-control" type="email" name="email"  placeholder="email">
                                                                                </div>
                                                                            </div>
                                                                        </div><!-- col-4 -->
                                                                        {# <div class="optional col-lg-4">
                                                                            <div class="form-group">
                                                                                    <label class="col-sm-4 form-control-label" align="">profil:<span class="tx-danger"></span></label>
                                                                                        <input type="file" name="photo" id="file-1"
                                                                                            class="inputfile" data-caption="files selected" accept=".png, jpg,jpeg">
                                                                                            <label for="file-1" class="if-outline if-outline-info">
                                                                                            <i class="icon ion-ios-upload-outline tx-24"></i>
                                                                                            <span>Choisisez la photo de profil</span>
                                                                                    </label>
                                                                            </div>
                                                                        </div><!-- col-4 --> #}
                                                                    </div>
                                                                
                                                                    <div class="form-layout-footer mg-t-30">
                                                                        <button type="button" class="btn btn-secondary" onclick="anuleraddclient()">Annuler</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                    </div>
                                                <!-- end bock nouveau client -->
                                            </div><!-- tab-pane -->
                                            <div class="tab-pane" id="recent2">
                                                
                                            </div>

                                            {#<button class="btn btn-primary" >
                                                <a href="{{path('client-add')}}" style="padding: 0px !important; color:white;" class=" nav-link ajax-link" >
                                                    <i class="fa fa-plus" aria-hidden="true"></i>Ajouter
                                                </a>
                                            </button>#}

                                            </div><!-- tab-pane -->

                                            
                                        </div><!-- card-body -->
                                    </div><!-- card -->
                                </div><!-- col -->
                            </div>
                        </div>
                        <br><br><br>
                        <button type="submit" id="btn-save-nouveau" class="btn btn-primary mg-r-5">Valider</button>
                    </form>
                        <button type="button" class="btn btn-secondary" onclick="hide()">Annuler</button>
                    </div>
                </div>
            </div>
        </div>
    

<script>
    
        $('#vefificationstatic').show();
        $('#vefificationenable').hide();
        $("#contentaftervalide").hide();
        $(".formelement").hide();


        $( ".typedechambre" ).change(function() {
            $('.tarifdeschambres').find('option').remove();
                $.ajax({
                    url: "/getalltarif?id="+$(this).children("option:selected").val(),
                    type: 'GET',
                }).done(function(data){
 
                    i=0;
                    while(i<data.length){
                        $('.tarifdeschambres').append('<option value="'+data[i].id+'" >'+data[i].nom+'('+data[i].prix+'FCFA - '+data[i].duree+'heure )'+'</option>');
                        i++;
                    }  
                        
                }).fail(function(error){
                    console.log("no ok");
                });
        });

   
</script>

<script>
    
    $("#canpay").hide();


    $( ".paiement" ).change(function() {
        tarif = $(".tarifdeschambres option:selected" ).text();
        montant = parseFloat(tarif.match(/-?(?:\d+(?:\.\d*)?|\.\d+)/)[0]);

        $.ajax({
            url: "/getcanpay?id="+$(this).children("option:selected").val(),
            type: 'GET',
        }).done(function(data){
            if(data >= montant){
                $("#canpay").show();
            }else{
                $("#canpay").hide();
            }
            /*i=0;
            while(i<data.length){
                $('.tarifdeschambres').append('<option value="'+data[i].id+'" >'+data[i].nom+'('+data[i].duree+'heure - '+data[i].prix+'FCFA )'+'</option>');
                i++;
            }*/  
                
        }).fail(function(error){
            console.log("no ok");
        });
    });


</script>

<script>
    
    function checkdisponibilteofroom() {
        $('#vefificationstatic').hide();
        $('#vefificationenable').show();
        $("#contentaftervalide").hide();
        var typechambre=$('.typedechambre').children("option:selected").val();
        //alert($('.typedechambre').children("option:selected").val());
        //alert($('.tarifdeschambres').children("option:selected").val());
        $('.chambres').find('option').remove();
        
        //alert($('#timeat').val());
        $.ajax({
            url: "/getallchambrelibre",
            type: 'POST',
            dataType: 'json',
            data:{"datearrivee": $('#timeat').val(),"typechambre": typechambre,"duree":$('.tarifdeschambres').children("option:selected").val(),
            "quantite":$('#quantiter').val()}
        }).done(function(data){ 
                    $('#vefificationstatic').show();
                    $('#vefificationenable').hide();
                    if(data.length==0){
                        
                            Swal.fire({
                                position: 'top-end',
                                icon: 'error',
                                title: "pas de chambre disponible",
                                showConfirmButton: false,
                                timer: 2000
                            })
                       
                    }else{
                        $("#contentaftervalide").show();
                        i=0;
                        while(i<data.length){
                            $('.chambres').append('<option value="'+data[i].id+'" >'+data[i].numero+'</option>');
                            i++;
                        } 
                    }
                     
                
        }).fail(function(error){
            $('#vefificationstatic').show();
            $('#vefificationenable').hide();
        });
    }
</script>
<script> 
function anuleraddclient() {
    $("#checkclient").prop("checked", false);
    $('#form-new-client').hide();
    $('#oldclient').show();
    $('.textnewclient').show();
}
$("#checkclient").prop("checked", false);
$('#form-new-client').hide();
$( "#btnaffformadd" ).click(function() {
 $('#form-new-client').show();
 $('#oldclient').hide();
 $("#checkclient").prop("checked", true);
 $('.textnewclient').hide();
});

$(".js-form-sendallocation").on('submit', function(e) {

    e.preventDefault();
    //////
    var idForm = $(this).attr('id');
    var element = $("#" + idForm + " #btn-save-nouveau");
    var element2 = $("#" + idForm + " #btn-save-nouveau");
    element.html('Chargement... <span class="fa fa-spinner fa-pulse"></span>');
    element.attr("disabled", "true");
    //////
    var dataform = $(this).serialize();
    $.ajax({
            url: "/allocationadd",
            type: 'POST',
            dataType: 'json',
            data:dataform
        }).done(function(data){ 
            $("#contentaftervalide").hide();
            element2.html('VALIDER');
            element2.attr("disabled", "false");
            if(data.success){
                    Swal.fire({
                    title: 'enregistrement terminer',
                    text: "Voulez vous imprimer la facture ?",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Imprimer'
                    }).then((result) => {
                    if (result.isConfirmed) {
                      window.open("/printrecuallocation?id="+data.id, '_blank');  
                    }
                    })
            }else{
                Swal.fire({
                    position: 'top-end',
                    icon: 'error',
                    title: "problème d'enregistrer !",
                    showConfirmButton: false,
                    timer: 2000
                })
            }        
                
        }).fail(function(error){
            console.log("no ok");
        });
}) 
</script>

{#  hide montant#}

<script>

</script>

{#  #}


<script>
    $("#form-filtre").on('submit', function(e){
      e.preventDefault();
        var jour = $("#jour").val();    
        var chambre = $("#chambre").val(); 
		var typechambre = $("#typechambre").val();   
        var url = "/filtreallocation?jour="+jour+"&chambre="+chambre+"&typechambre="+typechambre;        ;
        var effect = guessEffect(this, "#monContent");
        ajaxLink(url, "monContent", "html", effect);        
    })

</script>