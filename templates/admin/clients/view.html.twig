<style>
.zoom {
	padding: 5px;
	/*background-color: green;*/
	transition: transform .3s; /* Animation */
	width: 100px;
	height: 100px;
	margin: 0 auto;
	}
	
	.zoom:hover {
	transform: scale(1.1); /* (150% zoom - Note: if the zoom is too large, it will go outside of the viewport) */
	}

.tab {
  overflow: hidden;
  border: 1px solid #ccc;
  background-color:#696969;
  size: 0px;
  color: #ccc;
}


/* Style the buttons that are used to open the tab content */
.tab button {
  background-color: inherit;
  float: left;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 10px 25px;
  transition: 0.3s;
}

/* Change background color of buttons on hover */
.tab button:hover {
  background-color: #ddd;
}

/* Create an active/current tablink class */
.tab button.active {
  background-color: #ccc;
}

/* Style the tab content */
.tabcontent {
  display: none;
  padding: 6px 12px;
  border: 1px solid black;
  border-top: none;
}

.h5{
	color:white;
}


.tabcontent {
  animation: fadeEffect 1s; /* Fading effect takes 1 second */
}

/* Go from zero to full opacity */
@keyframes fadeEffect {
  from {opacity: 0;}
  to {opacity: 1;}
}
.btn-group .btn:hover {
	cursor: pointer;
}

</style>

<div class="br-pagetitle">
	<i class="fas fa-signal"></i>
	<div>
	<h4>Clients</h4>
	<p style="color:blue;" class="mg-b-0">----</p>
	</div>
</div><!-- d-flex -->



	<div class="row row-sm mg-t-25 mg-l-5 mg-t-5">
		<div class="col-3">
			<div class="card bd-primary">
				<div class="card-header bg-primary tx-white">
					Profile Photo
				</div>
				<!-- card-header -->
				<div class="card-body tx-center">
					
					<div class="mg-t-20">
						<form style="" action="" id="form-addFidele" class="" method="POST" enctype="multipart/form-data">
							{#<img src="{{asset('photo/Chambre/'~ client.photo)}}" 
							height="100px" width="250" alt="dropdown image" 
							class="img-responsive">
							<br>#}
							{% if client.sexe == "M" %}
							{% if client.photo %}
								<img src="{{asset('photo/Chambre/'~ client.photo)}}" height="150px" width="250">
							{% endif %}
							<img src="{{asset('photo/Avatar/avatarmale.jpeg')}}" height="150px" width="250">
							{% elseif client.sexe == "F" %}	
								<img src="{{asset('photo/Avatar/avatarfemale.png')}}" height="150px" width="250">
								{% elseif client.sexe == "" %}	
								<img src="{{asset('photo/Avatar/none.png')}}" height="150px" width="250">
							{% endif %}
						</form>
					</div>
				</div>
				
				<div class="card-header bg-primary tx-white">
					Envoyer Un Mail
				</div>
				<!-- card-header -->
				<div class="card-body tx-center">
					<div class="mg-t-20">
						<form style="" action=""  class="" method="POST" enctype="multipart/form-data">
							<div>
								<label for="email" class="label" align="left">Addresse Email </label>
								<input id="objet" class="form-control modif" type="email" name="objet" value="{{client.email}}" disabled>
								<label for="objet" class="label">objet</label>
								<input id="objet" class="form-control modif" type="text" name="objet">
							</div>
							<div>
								<label for="exampleFormControlTextarea1" class="label">message</label>
								<textarea class="form-control" id="exampleFormControlTextarea1" rows="3" name="message"></textarea>
								<div class="row row-xs mg-t-30">
									<div class="col-sm-12 mg-l-auto">
											<button type="submit" id="btn-save-nouveau" class="btn btn-success mg-r-5">ENVOYER</button>
										<!-- form-layout-footer -->
									</div>
									<!-- col-8 -->
								</div>
							</div>
						</form>
					</div>
				</div>
				
				<!-- card-header -->
				<div class="card-header bg-primary tx-white">
					Créditer un compte 
				</div>
				<div class="card-body tx-center">
					<div class="mg-t-20">
						<div class="container-fixed" align="center">
							{% for message in app.flashes('success') %}
							<div class="alert alert-success">
								{{ message }}
							</div>
							{% endfor %}
						</div>
						<div class="container-fixed" align="center">
							{% for message in app.flashes('danger') %}
							<div class="alert alert-danger">
								{{ message }}
							</div>
							{% endfor %}
						</div>
						<input id="objet" class="form-control modif" type="email" name="objet" value="{{client.solde}} XAF" disabled><br>
						<form id="form-send" class="js-form-sendavecfile sauvegardededonne"
							action="{{path('opperation')}}" data-toggle="ajax" data-target="monContent" method="POST">
								{#<div class="form-group" >
									<select class="form-control" name="type">
										<option label="">Type de l'opération</option>
										<option value="debit">Débiter</option>
										<option value="credit">Créditer</option>
									</select>
								</div>#}
								<div class="form-group" >
									<label class="form-control-label">Montant</label>
									<input class="form-control" type="number" name="montant">
									<input type="hidden" id="client" class="form-control modif" name="client" value="{{client.id}}">
								</div>
								<div>
									<div class="row row-xs mg-t-30">
										<div class="col-sm-12 mg-l-auto">
											<button type="submit" id="btn-save-nouveau" class="btn btn-success mg-r-5">Valider</button>
											<!-- form-layout-footer -->
										</div>
										<!-- col-8 -->
									</div>
								</div>
						</form>
					</div>
				</div><!-- card-body -->
			</div>
		</div>
		<!-- col-3 -->
		<div class="col-9">
			{#<form id="form-send" style="" action="" class="js-form-send" method="PUT">#}
				<input type="hidden" name="id" value="">
				<input type="hidden" name="code" value="">
				<div class="card bd-primary">
					<div class="card-header bg-primary tx-white">
					<a href="{{path('index-client')}}" class=" text-white float-left" data-toggle="ajax" data-target="monContent"><i class="fa fa-arrow-left"></i> </a>
						Informations du client {{client.nom}}
					</div>
					<!-- card-header -->
					<div class="card-body">
						<div class="row row-xs">
							<div class="col-lg-6">
								<label for="">Nom:
								</label>
								<input type="text" id="nom" class="form-control modif" name="nom" value="{{client.nom}}" disabled>
							</div>
							<div class="col-lg-6">
								<label for="">Prenom:
								</label>
								<input type="text" id="prenom" name="prenom" class="form-control modif" value="{{client.prenom}}" disabled>
							</div>
						</div>

						<div class="row row-xs  mg-t-20">
							<div class="col-lg-6">
								<label for="">Etatcivil:
								</label>
								<input type="text" id="telephone1" class="form-control modif" name="telephone1" value="{{client.etatcivil}}" disabled>
							</div>
							<div class="col-lg-6">
								<label for="">sexe:</label>
								<input type="text" id="telephone1" class="form-control modif" name="telephone1" value="{{client.sexe}}" disabled>

								</label>
							</div>
						</div>

						<div class="row row-xs  mg-t-20">
							<div class="col-lg-4">
								<label for="">CNI:</label>
								<input type="text" id="telephone2" name="telephone2" class="form-control modif" value="{{client.cni}}" disabled>
							</div>
							<div class="col-lg-4">
								<label for="">Date de naissance:</label>
								<input type="text" id="datenaiss" class="form-control modif datepicker" name="datenaiss" value="{{client.datenaisance | date('d-m-Y')}}"  style="height: 40px;" disabled>
							</div>
							<div class="col-lg-4">
								<label for="">Lieu de naissance:
								</label>
								<input type="text" id="lieunaiss" name="lieunaiss" class="form-control modif" value="{{client.lieunaisance}}" disabled>
							</div>
						</div>
						<div class="row row-xs  mg-t-20">
							<div class="col-lg-4">
								<label for="">Profession: 
								</label>
								<input type="text" id="lieunaiss" name="lieunaiss" class="form-control modif" value="{{client.profession}}" disabled>
							</div>
							<div class="col-lg-4">
								<label for="">nationalite:
								</label>
								<input type="text" id="lieunaiss" name="lieunaiss" class="form-control modif" value="{{client.nationalite}}" disabled>

							</div>
							<div class="col-lg-4">
								<label for="">telephone:
								</label>
								<input type="text" id="lieunaiss" name="lieunaiss" class="form-control modif" value="{{client.phone}}" disabled>

							</div>
						</div>
						<div class="row row-xs  mg-t-20">
							<div class="col-lg-6">
								<label for="">adresse:
								</label>
								<input type="text" id="lieunaiss" name="lieunaiss" class="form-control modif" value="{{client.adresse}}" disabled>

							</div>
							<div class="col-lg-6">
								<label for="">email:
								</label>
								<input type="text" id="lieunaiss" name="lieunaiss" class="form-control modif" value="{{client.email}}" disabled>

							</div>
						</div>
					</div>
				</div>
		
				<div class="row row-sm">
					<div class="col-sm-12 col-xl-12">
						<div class="col-md mg-t-20 mg-md-t-0">
							<div class="card bd-0">
								<div class="card-header bg-dark">
								<ul class="nav nav-tabs nav-tabs-for-dark card-header-tabs">
									<li class="nav-item">
									<a class="nav-link bd-0 active pd-y-8" href="#popular2" data-toggle="tab">Note</a>
									</li>
									<li class="nav-item">
									<a class="nav-link bd-0 tx-gray-light" href="#recent2" data-toggle="tab">Reservation</a>
									</li>
									<li class="nav-item">
									<a class="nav-link bd-0 tx-gray-light" href="#toprated2" data-toggle="tab">Allocation</a>
									</li>
									<li class="nav-item">
									<a class="nav-link bd-0 tx-gray-light" href="#tarif" data-toggle="tab">Heberger</a>
									</li>
									<li class="nav-item">
									<a class="nav-link bd-0 tx-gray-light" href="#transaction" data-toggle="tab">Opération d'acompte</a>
									</li>
								</ul>
								</div><!-- card-header -->
								<div class="card-body color-gray-lighter bd bd-t-0 rounded-bottom">
								<div class="tab-content">
									<div class="tab-pane active" id="popular2">
										<div class="row row-sm">
											<div class="col-sm-12 col-xl-12">
												<div class="container-fixed" align="center">
												{% for message in app.flashes('notesuccess') %}
													<div class="alert alert-success" role="alert">
														<button type="button" class="close" data-dismiss="alert" aria-label="Close">
															<span aria-hidden="true">&times;</span>
														</button>
														<div class="d-flex align-items-center justify-content-start">
															<i class="icon ion-ios-checkmark alert-icon tx-32 mg-t-5 mg-xs-t-0"></i>
															<strong class="d-block d-sm-inline-block-force">{{ message }}</strong>
														</div>
													</div><!-- alert -->
												{% endfor %}
												</div>
												<div class="container-fixed" align="center">
												{% for message in app.flashes('notedanger') %}
													<div class="alert alert-danger" role="alert">
														<button type="button" class="close" data-dismiss="alert" aria-label="Close">
															<span aria-hidden="true">&times;</span>
														</button>
														<div class="d-flex align-items-center justify-content-start">
															<i class="icon ion-ios-checkmark alert-icon tx-32 mg-t-5 mg-xs-t-0"></i>
															<strong class="d-block d-sm-inline-block-force">{{ message }}</strong>
														</div>
													</div><!-- alert -->
												{% endfor %}
												</div>
												
												<form id="form-send" class="js-form-sendavecfile sauvegardededonne"
													action="{{path('note-client')}}" data-toggle="ajax" data-target="monContent" method="POST">
													<h2 align="center" style="color:black;">Note Interne</h2>
													<input type="hidden" id="client" class="form-control modif" name="client" value="{{client.id}}">
													<textarea class="form-control" id="exampleFormControlTextarea1" rows="3" name="content"></textarea>
													<button type="submit" class="btn btn-success mg-r-5">ENVOYER</button>
												</form>
											</div>
											{% if notes is iterable %}
												{% for note in notes %}
													<div class="card bd-0 zoom" style="width:100%;">
														<div class="card-header bg-teal tx-white">
															Commentaire de <span class="tx-dark">{{ note.createdby.username }}</span> Du <span class="tx-dark">{{ note.createdat | date('d-m-Y-H:m:s') }}</span>
														</div><!-- card-header -->
														<div class="card-body bd bd-t-0 rounded-bottom">
															{{ note.content }}
														</div><!-- card-body -->
													</div><!-- card -->
												{% endfor %}
											{% endif %}
										</div>
									</div><!-- tab-pane -->
									<div class="tab-pane" id="recent2">
									<h4>Liste des Reservation</h4>
										<table class="datatable table display responsive nowrap">
											<thead>
												<tr>
													<th class="wd-15p">ID</th>
													<th class="wd-15p">Client </th>
													<th class="wd-20p">Date de debut</th>
													<th class="wd-15p">Date de fin</th>
													<th class="wd-10p">Montant</th>
													
												</tr>
											</thead>
											{% if reservations is iterable %}
											<tbody>
											{% for reservation in reservations %}
											
											<tr>
												<td>{{ loop.index}}</td>
												<td>{{ reservation.client.nom}}</td>
												<td>{{ reservation.datedariver | date('d-m-Y') }}</td>
												<td>{{ reservation.datedepart | date('d-m-Y') }}</td>
												<td>{{ reservation.montan}}</td>
											</tr>
											{% else %}
												<p>Cette Chambre n'a jamais été reserver</p>
											{% endfor %}
											</tbody>
											{% endif %}
										</table>	
									</div><!-- tab-pane -->

									<div class="tab-pane" id="transaction">
										<h4>Détail des transactions</h4>
										<h4>Solde : {{client.solde}} XAF</h4>
										<table class="datatable table display responsive nowrap">
											<thead>
												<tr>
													<th class="wd-15p">ID</th>
													<th class="wd-15p">Opération</th>
													<th class="wd-20p">Date</th>
													<th class="wd-15p">Responsable</th>
													<th class="wd-10p">Montant</th>
													
												</tr>
											</thead>
											{% if transactions is iterable %}
											<tbody>
											{% for transaction in transactions %}
												{% if transaction.type == 'Créditer' %}
													<tr class="tx-teal">
												{% else %}
													<tr class="tx-danger">
												{% endif %}
													<td>{{ loop.index}}</td>
													<td >{{ transaction.type}}</td>
													<td>{{ transaction.createdat | date('d-m-Y-H:m:s') }}</td>
													<td>{{ transaction.createdby.username}}</td>
													<td>{{ transaction.montant}}</td>
												</tr>
											{% else %}
												<p>Cette Chambre n'a jamais été reserver</p>
											{% endfor %}
											</tbody>
											{% endif %}
										</table>	
									</div><!-- tab-pane -->



									<div class="tab-pane" id="toprated2">
										<h4>Liste des Allocation</h4>
											<table class="datatable table display responsive nowrap">
											<thead>
												<tr>	        
													<th class="wd-15p">ID</th>
													<th class="wd-15p">Occupants</th>
													<th class="wd-15p">Chambres</th>
													<th class="wd-25p">DATE DE DÉPART</th>
													<th class="wd-25p">Date de fin</th>
													
												</tr>
											</thead>
											{% if allocations is iterable %}
											<tbody>
											{% for allocation in allocations %}
										
												<tr>
													<td>{{loop.index}}</td>
													<td>{{allocation.occupant.username}}</td>
													<td>{{allocation.chambre.type.nom}}</td>
													<td>{{allocation.datedebut | date('d-m-Y')}} </td>
													<td>{{allocation.datefin | date('d-m-Y')}}</td>
												</tr>
											{% else %}
												<p>Cette Chambre n'a jamais été reserver</p>
											{% endfor %}
											</tbody>
											{% endif %}
										</table>
									</div><!-- tab-pane -->
									<div class="tab-pane" id="tarif">
										<h4>Heberger </h4>
										<div class="row row-sm">
										
											<form id="form-send" class="js-form-sendallocation {{app.user.hasAccess('allocation-add')}}" action="{{path('allocation-add')}}" method="POST">
												<div class="form-layout form-layout-1">
													<div class="row mg-b-2">
														<div class="col-lg-3" style="display:none">
															<div class="form-group" >
																<label class="form-control-label">Client : <span class="tx-danger">*</span></label>

																{# <input type="hidden" id="nom" class="form-control modif" name="client" value="{{client.nom}}" > #}
																<select name="client" class="form-control js-select2" data-placeholder="Choose one" style="width: 100%" required>
																	{# <option value="--Selectionner un client--"></option> #}
																	
																		<option value="{{client.id}}">{{client.nom}}</option>
																	
																</select>

															</div>
														</div>
														<div class="col-lg-4">
															<div class="form-group">
																<label class="form-control-label">Type de Chambres: <span class="tx-danger">*</span></label>
																<select name="typebed" class="form-control typedechambre js-select2" data-placeholder="Choose one" style="width: 75%">
																	<option value="0">Sélectionner le type</option>
																	{% for chambre in typchambres %}
																		<option value="{{chambre.id}}">{{chambre.nom}}</option>
																	{% endfor %}
																</select>
															</div>
														</div>
													
														<div class="col-lg-4">
															<div class="form-group">
																<label class="form-control-label">Heure d'arrivée  : <span class="tx-danger">*</span></label>
																<div class="d-flex">
																	<div class="input-group wd-300">
																		<input id="timeat" name="arriver" type="datetime-local" min="now" class="heurearivee form-control">
																	</div><!-- input-group -->
																</div>
															</div>
														</div>
														<div class="col-lg-4">
															<div class="form-group">
																<label class="form-control-label">Durée : <span class="tx-danger">*</span></label>
																<select name="sejourclient" class="form-control tarifdeschambres js-select2" data-placeholder="Choose one">
																	<option value="0">Durée du sejour</option>
																</select>
															</div>
														</div>
													</div>
													<div class="row mg-b-2">
														<div class="col-lg-3">
															<div class="form-group">
																<label class="form-control-label">Quantité <span class="tx-danger">*</span></label>
																<input value="1" id="quantiter"  class="form-control" type="number" name="qte">
																<input id="user" style="display:none;" class="form-control" type="text" value="{{ client.id}}">
															</div>
														</div>
														<div class="col-lg-3">
															<a onclick="checkdisponibilteofroom()" style="margin-top: 30px; color:white;" class="btn btn-primary btn-with-icon">
																<div class="ht-40 justify-content-between">
																	<span class="pd-x-15">Verifier</span>
																	<span class="icon wd-40"><i id="vefificationstatic" class="fa fa-check-circle"></i> <i id="vefificationenable" class="fa fa-spinner fa-pulse"></i></span>
																</div>
															</a>
														</div>
														<div class="col-lg-4">
															<div class="form-check form-check-inline" id="canpay">
                                                                <input class="form-check-input" type="checkbox" name="radio" id="inlineRadio1" value="acompte">
                                                                <label  for="inlineRadio1">Payer avec acompte</label>
                                                            </div>
														</div>
														
													</div>
													<div id="contentaftervalide">
														<div class="row mg-b-25">
															<div class="col-lg-8">
																<div class="form-group mg-b-10-force">
																	<label class="form-control-label">Chambre disponible: <span class="tx-danger">*</span></label>
																	<select name="chambre" class="paiement form-control chambres js-select2" data-placeholder="Choose one" style="width: 75%">
																		
																	</select>
																</div>
															</div>
														</div>
														<div class="form-layout-footer">
															<button type="submit" id="btn-save-nouveau" class="btn btn-primary mg-r-5">Valider</button>
															<button type="button" class="btn btn-secondary" onclick="hide()">Annuler</button>
														</div>
													</div>
												</div>
												</div>
											</form>


										
										</div>
									</div><!-- tab-pane -->


								</div><!-- tab-content -->
								</div><!-- card-body -->
							</div><!-- card -->
						</div><!-- col -->
					</div>
				</div><!-- card-body -->
				
		</div> 
		<!-- col-9 -->
	</div>

		</div>
		<!-- end br-mainpanel -->
	
<script>
    $(document).ready(function () {
        $('#vefificationstatic').show();
        $('#vefificationenable').hide();
        $("#contentaftervalide").hide();
        $(".formelement").hide();

     
        $( ".typedechambre" ).change(function() {
            $('.tarifdeschambres').find('option').remove();
                $.ajax({
                    url: "/getalltarif?id="+$(this).children("option:selected").val(),
                    type: 'GET',
                }).done(function(data){

                    console.log(data.length);  
                    i=0;
                    while(i<data.length){
                        $('.tarifdeschambres').append('<option value="'+data[i].id+'" >'+data[i].nom+'('+data[i].duree+'heure - '+data[i].prix+'FCFA )'+'</option>');
                        i++;
                    }  
                        
                }).fail(function(error){
                    console.log("no ok");
                });
        });

    });
</script>

<script>
    
    $("#canpay").hide();


    $( ".paiement" ).change(function() {
        tarif = $(".tarifdeschambres option:selected" ).text();
        montant = parseFloat(tarif.match(/-?(?:\d+(?:\.\d*)?|\.\d+)/)[0]);
		
		
        $.ajax({
            url: "/getcanpay?id="+$("#user").val(),
            type: 'GET',
        }).done(function(data){
            if(data >= montant){
                $("#canpay").show();
            }else{
                $("#canpay").hide();
            }
            /*i=0;
            while(i<data.length){
                $('.tarifdeschambres').append('<option value="'+data[i].id+'" >'+data[i].nom+'('+data[i].duree+'heure - '+data[i].prix+'FCFA )'+'</option>');
                i++;
            }*/  
                
        }).fail(function(error){
            console.log("no ok");
        });
    });


</script>

<script>
    function checkdisponibilteofroom() {
        $('#vefificationstatic').hide();
        $('#vefificationenable').show();
        $("#contentaftervalide").hide();
        var typechambre=$('.typedechambre').children("option:selected").val();
        //alert($('.typedechambre').children("option:selected").val());
        //alert($('.tarifdeschambres').children("option:selected").val());
        $('.chambres').find('option').remove();
        
        //alert($('#timeat').val());
        $.ajax({
            url: "/getallchambrelibre",
            type: 'POST',
            dataType: 'json',
            data:{"datearrivee": $('#timeat').val(),"typechambre": typechambre,"duree":$('.tarifdeschambres').children("option:selected").val(),
            "quantite":$('#quantiter').val()}
        }).done(function(data){ 
                    $('#vefificationstatic').show();
                    $('#vefificationenable').hide();
                    if(data.length==0){
                        
                            Swal.fire({
                                position: 'top-end',
                                icon: 'error',
                                title: "pas de chambre disponible",
                                showConfirmButton: false,
                                timer: 2000
                            })
                       
                    }else{
                        $("#contentaftervalide").show();
                        i=0;
                        while(i<data.length){
                            $('.chambres').append('<option value="'+data[i].id+'" >'+data[i].numero+'</option>');
                            i++;
                        } 
                    }
                     
                
        }).fail(function(error){
            $('#vefificationstatic').show();
            $('#vefificationenable').hide();
        });
    }
</script>
<script>
$(".js-form-sendallocation").on('submit', function(e) {
    e.preventDefault();
    //////
    var idForm = $(this).attr('id');
    var element = $("#" + idForm + " #btn-save-nouveau");
    var element2 = $("#" + idForm + " #btn-save-nouveau");
    element.html('Chargement... <span class="fa fa-spinner fa-pulse"></span>');
    element.attr("disabled", "true");
    //////
    var dataform = $(this).serialize();
    $.ajax({
            url: "/allocationadd",
            type: 'POST',
            dataType: 'json',
            data:dataform
        }).done(function(data){ 
            $("#contentaftervalide").hide();
            element2.html('VALIDER');
            element2.attr("disabled", "false");
            if(data.success){
                    Swal.fire({
                    title: 'enregistrement terminer',
                    text: "Voulez vous imprimer la facture ?",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Imprimer'
                    }).then((result) => {
                    if (result.isConfirmed) {
                      window.open("/printrecuallocation?id="+data.id, '_blank');  
                    }
                    })
            }else{
                Swal.fire({
                    position: 'top-end',
                    icon: 'error',
                    title: "problème d'enregistrer !",
                    showConfirmButton: false,
                    timer: 2000
                })
            }       
                
        }).fail(function(error){
            console.log("no ok");
        });
}) 
</script>







